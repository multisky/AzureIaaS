## Azure IaaS 기본 권장 아키텍처 개요 및 준비

> 본 문서는 "있는 그대로" 제공됩니다. URL 및 다른 인터넷 웹 사이트 참조를 비롯하여 이 설명서에 제공된 정보와 내용은 예고 없이 변경될 수 있습니다. 여기에서 설명하는 일부 예는 설명 목적으로만 제공되는 가상의 예이며, 어떠한 실제 사례와도 연관시킬 의도가 없으며 그렇게 유추해서도 안 됩니다. 이 문서는 Microsoft 제품의 지적 재산권에 대한 어떠한 법적 권한도 부여하지 않습니다. 개인적인 목적과 참조용으로만 이 문서를 복사하고 사용할 수 있습니다. 이 문서는 기밀이며 Microsoft가 소유합니다. 이 문서는 비밀 유지 계약에 따라서만 공개되며 사용할 수 있습니다.
기밀. 비밀 유지 계약 하의 파트너에게만 배포됩니다. Microsoft는 어떠한 명시적 또는 묵시적 보증도 하지 않습니다.

## Azure IaaS V2(ARM)로 구성하는 기본 아키텍처

> 주의 I  
> 이 문서는 Azure IaaS를 처음 접하는 이들을 위해서 작성된 문서가 아닙니다. 이미 기초적인 Azure의 개념을 알고 있고 기본적인 IaaS의 구성을 수행해 본 이들을 대상으로, 그들이 알고 있는 지식들을 실습을 통해서 정리할 수 있도록 구성되었습니다. 이 문서는 기본적인 IaaS 아키텍처에 대한 예시를 제공합니다. 그렇기에, 기본적인 IaaS 구성요소들(예, 가상 컴퓨터, 가용성 집합, 부하 분산, 가상 네트워크, 저장소 계정 등)이 무엇인지에 대해서는 다루지 않으며, 이미 그러한 요소들에 대해 이해하고 있다고 가정하고 진행 합니다. IaaS에 대한 기초 지식과 각 구성요소에 대한 설명은 다른 문서를 참고하시기 바랍니다. 2016년에 번역 출간된 “마스터링 Microsoft Azure IaaS” 서적도 추천합니다.

> 주의 II  
> 이 문서에서 사용하고 있는 캡처된 이미지는 문서 작성시(2017년 3월 기준)의 Azure Portal의 화면을 캡처한 것이기 때문에 여러분이 읽는 시점에는 실제 Portal 화면과 다소 차이가 있을 수 있습니다. 이는 지금도 Azure Portal은 계속해서 개선되고 변경되고 있기 때문입니다. 하지만, 약간의 차이가 있더라도  식별 가능한 수준일 것이기에 실습을 진행하는 데에는 무리가 없을 것입니다.

일반적으로 Azure IaaS 환경을 처음 접하는 경우에는, 빠른 테스트를 위해서 무작정(일단) 가상 컴퓨터를 만드는 것으로 시작하기 쉽습니다. 다만, 이렇게 초기 테스트를 위한 목적으로 구성된 환경이 추후 스테이징이나 운영 환경을 구축하는 경우에 그대로 재활용하게 되는 일이 잦은 편이기에 뒤늦게 설계적인 미흡함으로 인한 곤란함을 겪을 수 있습니다. 

또한, 기존의 서적이나 온라인 컬럼이 IaaS V1(ASM)을 기반으로 설명되어 있거나 V1(ASM)과 V2(ARM)를 혼합하여 설명하고 있기 때문에, V2(ARM)만을 사용하여 IaaS를 구성하고자 하는 이들은 현재 시점에서 어떤 기술 및 구성요소로 IaaS를 구성하는 것이 바람직한지 다소 혼란스러울 수 있습니다. 

IaaS V1(ASM)은 주로 [가상 컴퓨터(클래식)]으로 VM을 생성하고, [클라우드 서비스]라는 논리 컨테이너 개념을 사용하여 각각의 VM들을 그룹 짓곤 했습니다만, V2(ARM)에서는 그러한 구성요소를 사용하지 않습니다. IaaS V1(ASM)의 [클라우드 서비스]는 VM들을 위한 논리적 컨테이너로서의 역할 뿐 아니라 부하 분산 장치 및 자동 규모 조정, 외부 접근을 위한 가상 IP의 역할도 수행했습니다. 클라우드 서비스가 다양한 역할을 모두 맡아서 해 주었기 때문에 상당한 편리함이 있었습니다만 장점 못지 않게 다양한 제약도 존재했으며, 다소 복합적인 구성을 해야 할 경우에는 지나치게 설정이 복잡해지는 경향도 있었습니다. 더불어, IaaS V1(ASM) 관련 몇몇 설정들은 Azure 포탈에서 UI로 지원되지 않으며 PowerShell을 사용하여 별도로 작업해야만 하는 경우도 많습니다. 

IaaS V2(ARM)에서는 더 이상 클라우드 서비스라는 개념을 사용하지 않으며, 리소스 그룹(Resource Group)이라는 논리적 그룹 하에서 여러분이 직접 각각의 필요한 구성요소를 선택하여 사용할 수 있도록 효과적으로 바뀌었습니다. 또한, IaaS V2(ARM)에서는 대부분의 구성 및 설정을 PowerShell이 아닌 Azure 포탈의 UI를 통해서 설정할 수 있습니다(물론, PowerShell을 사용할 수도 있으며 이는 익숙해질 경우 막강한 편의성을 제공합니다). 그리고, 지원되는 기능 또한 지속적으로 빠르게 발전 및 개선되고 있습니다.

이 문서에서는 IaaS V2(ARM)를 기반으로 인프라를 구성하는 경우 가급적 따라야 할 구현 순서와 기본적인 아키텍처를 제공함으로써 여러분들이 더욱 깔끔하게 IaaS 클라우드를 활용할 수 있도록 돕고자 합니다. 그렇기에, Azure IaaS V2(ARM)를 기반으로 개발, 테스트, 운영을 위한 인프라를 설계하는 경우에는 다음의 기본적인 순서에 따라 인프라를 설계하는 것을 고려해 보시기 바랍니다.

전체적인 기본 아키텍처는 그림 1.1과 같습니다. 이는 Microsoft의 공식 가이드라인은 아니며 예시로 제공하는 아키텍처임에 유의하시기 바랍니다. 그렇기에, 설계 시 참고를 위한 용도로만 활용하실 것을 권장합니다. 

더불어, 예시 아키텍처의 Subnet (Backend)은 대규모 설계에서는Subnet(Mid-Tier)로 취급할 수도 있으며, 규모에 따라서는 여러 Subnet을 추가하여 더 심도 있는 구성을 하는 것도 가능할 것입니다. 예를 들면, 데이터베이스 서버들로 구성된 Subnet(DB-Tier) 등을 추가하는 식으로 설계를 확장할 수 있습니다.

> 노트 : 하기 설계에 따라 테스트를 수행하는 데 소비되는 Azure 비용은 대략 800원/시간 혹은 20,000원/일 가량 나올 것으로 예상됩니다. 다만, 이는 집필 시점의 Azure 요금 계산기에 의한 추정 치이며, 실제 비용은 다를 수 있습니다. 

![images/1.1.png](그림 1 기본적인 IaaS 아키텍처 예시)

그림 1 기본적인 IaaS 아키텍처 예시

기억해야 할 기본적인 설계 순서는 다음과 같습니다. <U>몇몇 IaaS의 구성요소는 일단 생성하고 나면 부분적으로 변경할 수 없거나 혹은 리소스의 종속 관계를 변경할 수 없는 경우가 간혹 있기 때문에 아래의 순서는 대단히 중요</U>합니다.

1.	리소스 그룹 생성
2.	가상 네트워크와 서브넷
3.	가용성 집합(Availability Set)
4.	저장소 계정(Storage Account) 
5.	가상 컴퓨터(VM)
6.	외부 부하분산 집합
7.	내부 부하분산 집합 
8.	네트워크 보안 그룹(NSG, Network Security Group)
9.	공용 IP 주소 (및 고정 IP)
